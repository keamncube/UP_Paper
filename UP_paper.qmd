---
format:
  pdf:
    tbl-cap-location: top
    dpi: 500
    fig-pos: "H"
    number-sections: true
    cite-method: natbib
    include-in-header: 
      - text: |
          \usepackage{lscape}
          \newcommand{\blandscape}{\begin{landscape}}
          \newcommand{\elandscape}{\end{landscape}}
          \usepackage{rotating}
          \newcommand{\bsideways}{\begin{sidewaystable}[htbp]}
          \newcommand{\esideways}{\end{sidewaystable}}
      - file: preamble.tex 
    include-before-body: title.tex
    keep-tex: TRUE
  docx:
    reference-doc: new_template_no_numbering.docx
pdf-engine: xelatex
# monofont: "DejaVu Sans Mono"
# mainfont: "Times New Roman"
execute: 
  echo: false
  warning: false
editor: source
bibliography: references.bib
biblio-style: apalike
natbiboptions: round
link-citations: true
linkcolor: blue!000!black
urlcolor: blue!000!black
citecolor: blue!000!black
linestretch: 1.5
indent: TRUE
title-block-banner: false
title-block-style: none
---


```{r setup}
#| include=FALSE
options(scipen=999)
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      dpi = 500, 
                      fig.pos = "H", 
                      fig.env= 'figure', 
                      tab.topcaption = TRUE,
                      ft.align = "left",
                      ft.arraystretch = 0.5
                      )
library(tidyverse)
library(readr)
library(readxl)
library(zoo)
library(magick)
library(stringi)
library(patchwork)
library(xtable)
library(scales)
library(rvest)
library(rebus)
library(PNWColors)
library(lubridate)
library(here)
library(flextable)
library(gt)
library(officer)
library(officedown)
library(modelsummary)
library(sandwich)
library(lmtest)

set_flextable_defaults(
  font.size = 7,
  digits = 2,
  font.family = "Arial",
  border.color = "black",
  border.width = 0.5,
  fp_border = fp_border(color = "black", width = 0.5, style = "solid")
)


```

```{r functions}
source(here("Functions","flextable_word.R" ))
source(here("Functions","modelsummary_word.R" ))
source(here("Functions","modelplot_word.R" ))
source(here("Functions","borderlines.R" ))
```

# Introduction (Duma and Kea)

\textit{The pursuit for financial stability through macro-prudential policies could potentially imply financial exclusion, particularly in emerging countries such as South Africa. For instance, economic growth and development could be promoted through increased lending to small and medium businesses, who are riskier to lend to. However, macro-prudential policies are by nature aimed at reducing risks associated with lending. Therefore, a natural question that arises is whether macro-prudential policy is a constraint to or consistent with financial inclusion or greater banking competition?}


# Literature Review (Duma and Kea)
Our paper encompasses and contributes to various strands of literature. It firstly encompasses literature on the response of banks to  macroprudential reforms and secondly, the response of banks to external efforts aimed at enabling financial inclusion. The construction of narrative macroprudential reforms and narrative accounts of financial inclusion encompass  literature on narrative methods of identification. 

The objective(s) of macroprudential reforms are well documented and continue to expand with further reforms being introduced to create resilient banking systems\footnote{See \cite{kashyap2004cyclical}, \cite{basel06}, \cite{cohen2016banks} and \cite{cerutti2018changes} among others.}. The ongoing debate regarding the implications of the reforms, particularly on lending behaviour of banks provide further insight on the costs and benefits of making banking systems resilient through the reforms.  

Evidently, work on the cost or unintended consequences of macroprudential reforms have dominated the debate. \cite{noss2016estimating} highlight that tightened macroprudential capital requirements can cause banks' cost of funding to rise and in turn, prompt banks  to pass the increase in their cost of funding to borrowers in the form of high interest on loans and/or reduction in credit extended. \cite{deli2017real} show that higher capital requirements would lead banks to reduce their risk-weighted assets, implying a downward shift in lending in order to meet the capital requirements. As evidence, the former authors use a Vector Autoregressive (VAR) model to estimate the effect of changes in banks' capital requirements on lending in the United Kingdom (UK) and find that tighter capital requirements are associated with a reduction in lending, with the effect on corporate lending more pronounced relative to household lending.

Earlier work by \cite{aiyar2016does} study the interaction of capital requirements and monetary policy and response of UK banks to the two policies. Their findings show that  banks reduce  lending in response to tighter  capital reforms and monetary policy. They also exploit the heterogeneity of banks and find that large banks react to tighter capital requirements only, while small banks react to both policies. \cite{deli2017real} and \cite{mirzaei2022effectiveness} provide cross-country evidence on the effect of macroprudential reforms. The former authors conduct the analysis for banks in 125 countries and find weak negative effects of capital stringency on loan growth, especially for well-capitalized banks. \cite{mirzaei2022effectiveness} find similar results for banks in 91 countries, where small, less-capitalized and less-liquid banks reduce lending more in response to stringent capital requirements relative to banks that are well-capitalized and highly-liquid. 

With the use of various Dynamic Stochastic General Equilibrium (DSGE) models, \cite{angelini2015b}  find that a one percentage point increase in the capital ratio translates into a 0.09 percent loss in output relative to the level that would have prevailed in the absence of capital tightening. \cite{berka2018basel}   study the interaction between credit activity, Basel Accords banking regulations, household saving decisions and project returns with the use of a DSGE model, calibrated for the Canadian economy.  They find that Basel Accords in the form of capital requirements have an impact on loans, when project returns decline throughout the cycle as the requirements prompt banks to ration credit during downturns where project returns are low, implying increased default risk by borrowers (entrepreneurs).

Interestingly, work on the potential effect of macroprudential reforms in emerging markets is limited. The exception is recent work by \cite{fang2022bank} who  study the impact of rising capital requirements on lending in Peru. They exploit bank-level lending data and bank-specific capital buffers. Their findings show that higher capital requirements are associated with lower credit extension. The effects however vary according to economic conditions and bank characteristics, where less capitalized, less liquid and less profitable banks react more to tighter capital requirements. The effects are also more pronounced during economic downturns. In the case of South Africa, earlier work by \cite{maredza2016capital}  investigates the impact of increased bank requirements and in particular those introduced under Basel II on the cost of intermediation. Results from a panel of ten banks show that tighter capital requirements  increase the cost of intermediation, with the net interest margin serving as a proxy for the cost of intermediation. \cite{gumata2017bank} assess the impact of Basel III in the form of liquidity coverage ratio and net stable funding ratios on credit growth. Their decomposition exercise shows that  Basel III contributed to the contraction in credit post the GFC. 

Lastly, the construction of our narrative macroprudential reforms is based on the literature documenting narrative methods of identification. As outlined earlier, evidence on the response of bank lending to macroprudential reforms is based on the assumption that an increase in aggregate regulatory capital represents a negative credit supply shock and in turn have a negative effect on credit extension \citep{noss2016estimating}. As such,  our narrative accounts of macroprudential reforms  implicitly proxy for credit supply shocks. \cite{ramey2016macroeconomic} describes the narrative method of identification as constructing a series from historical documents to identify the reason and/or the quantities associated with a particular change in a variable. Furthermore, the construction of narrative accounts is particularly aimed at exclusively isolating shocks or effects of policy intervention\citep{angelopoulou2007narrative}. Therefore, by constructing a narrative series of macroprudential reforms, we aim to address challenges relating to the identification of macroprudential reforms and their impact thereof. The application of the identification strategy has largely focused on identifying monetary and fiscal shocks\footnote{See \cite{romer1989does}, \cite{romer1997identification} \cite{romer2004new} \cite{romer2010macroeconomic} \cite{ramey2011identifying} ]\cite{ramey2016macroeconomic} \cite{ramey2018government}.}. However, the approach is increasingly being applied to analyse and identify capital reforms. For instance, \cite{budnik2020identifying} analyse the dynamic effects of U.S macroprudential policies by   constructing a set of policy measures related to capital requirements  following the Basel III Accords. The  narrative instruments take a value of -1 and 1 in the case of  tightening and  easing of capital requirements, respectively and 0 otherwise.  Importantly, results from their analysis show that tightening of capital requirements induces a persistent decline in corporate credit. Further, the impact of a change in capital requirements is concentrated more on corporate credit relative to household credit.   \cite{eickmeier2018macroeconomic} also assess the dynamic effects of bank capital regulation in the U.S, where they use the narrative approach to construct an exogenous capital regulation index that captures exogenous changes in bank capital regulation. Their results also show persistent declines in corporate and investment loans and real estate loans, following changes in the capital regulation index.

We therefore add to the growing empirical literature examining; (1) the response of banks to changes in macroprudential reforms; (2)   particularly in emerging markets and (3); applying narrative methods of identification.

#  Narrative Indicators 

## Macroprudential reforms (kea)

This section presents actions and events we use to construct a set of macroprudential measures or indicators introduced following Basel II Agreements and Accords. The indicators represent credit supply shocks, following \cite{noss2016estimating} and \cite{deli2017real} among others. The construction is based on historical documents containing actions and events that  lead to the implementation of macroprudential regulations, from 2008 to 2019. We consult circulars issued by the SARB to commercial banks in South Africa, annual reports of commercial banks and SARB and risk and capital management reports of commercial banks. We consider reports of only the big 4 commercial banks in South Africa as they account for over 90 percent of  banking industry assets.\footnote{The big 4 banks include Standard Bank, ABSA, NEDBANK and First Rand.} We also consider documents published and issued by the Basel Committee on Bank Supervision (BCBS), containing communication between BCBS and SARB relating to the implementation of Basel regulations. 

Due to the wide variety of information contained in the documents, we impose a criteria with which we use to identify  actions and events that are most important in the construction of our narrative indicators. Since the set of macorprudential indicators proxy for credit shocks, the criteria imposed is such that:  (1) actions and events are specific in their intentions and (2), actions and events might imply a change in bank behaviour with respect to the adjustment of capital buffers and/or the attachment of greater risk weights to certain lending products or lending markets. From this, we are able to build a series of two narrative indicators $z_{t}$ defined such that $z_{t}=1$ for dates of events containing announcements and communication of  regulation intended to be passed and  the drafting of such regulation which we call $Draft$. The second indicator is  such that $z_{t}=1$ for dates of events recording the eventual implementation of the regulation, which we call $Implementation$. For dates where $Draft$ and $Implementation$ of regulation is not recorded $z_{t}=0$.
Therefore where possible, we also track the actions and events from the date they are communicated and or announced, issued or published ($Draft$), until the date they are introduced or implemented ($Implementation$).

The decomposition of the actions and events is done with the aim of possibly identifying anticipation effects following the drafting of regulation not yet implemented. For instance, \cite{eickmeier2018macroeconomic} analyse the macroeconomic effects of bank capital requirement tightenings using a narrative index of bank regulatory capital in the U.S. They find that bank assets (loans) and industrial production  fall 6 months before new rules become effective. The anticipation effects are captured by the banks' actions between dates when regulation is first mentioned in proposed rules and dates when the final rule is communicated. In effect, anticipation effects are therefore based on the notion that banks have information on the proposed regulation and dates which they will be implemented and as such, they can act (expand credit for instance) before implementation date and thereby take advantage of less stringent requirements on credit extension due to regulation before tighter requirements are introduced.
 
Information contained  in the documents we use to construct our narrative indicators also contain details enabling us to exploit such anticipation effects.

Importantly, we do not identify the impact of individual regulations and requirements under Basel Accords and Agreements but rather, we consider Basel regulations in their entirety. Although different Basel regulations such as the capital  and liquidity requirements target different instruments, the entirety of Basel regulations, which both capital  and liquidity requirements fall under, is aimed at creating resilient and robust banking systems, through higher bank capital  requirements and subsequently, increased bank  capital holdings \citep{cohen2016banks} \citep{cerutti2018changes}.

As an example to some of the actions we use to construct the two sets of indicators, the implementation of Basel II on January 1, 2008 is categorized as an implementation indicator. Further example occurs on February 4, 2009, which we categorize as a $Draft$ indicator, where the  SARB issues  directive 1/2009 (1 of 2009) announcing the approach banks should follow in the application of capital floors. "Modelled capital should not be below 80\% of the capital requirements under Basel I to ensure capital levels do not fall below prudent level". 

Following Basel II, banks are allowed to use internal models to determine risk weights and in turn, determine capital levels. However, capital floors ensure capital requirements did not fall below a certain percentage of banks’ capital requirements under the previous Basel I framework\citep{basel06}. This in essence, imply greater risk weight arched to riskier credit products. For instance,  \cite{imbierowicz2018time} show that Danish banks reducing their lending on loans with higher risk weights, in response to higher capital requirements, including approaches to capital floors.  A further example which is categorized as a $Draft$ indicator and tracked until implementation, occurs on July 31, 2009, where the BCBS announces "measures to strengthen the 1996 rules governing trading book capital and to enhance the three pillars of the Basel II framework (Basel 2.5)". This in essence, aims  to introduce higher capital requirements to capture the credit risk of complex trading activities, promote the build-up of capital buffers that can be drawn down in periods of stress and strengthen the quality of bank capital\citep{basel09}. The SARB endorsed and gave notices to banks to prepare for the implementation therefore, on October 8, 2010, following the communication by the BCBS on July 31, 2009. Following both communications and announcements,  Basel 2.5 is eventually implemented January 1, 2012. 

# Finance regulation reforms (Duma)


# Data and Methodology

## Data (Duma and Xolani)

Still to come...
\textit{It is important to note that policy indicators capturing macroprudential reforms are not-bank specific . For instance, banks in our panel may at their discretion, increase their capital buffers in addition to minimum requirements. However, the minimum macroprudential (predominantly capital requirements) reforms are applied uniformly across banks}.

\newpage

```{r}
#| label: tbl-descriptive
#| tbl-cap: "Descriptive Statistics"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 0.5

descriptives <- read_rds(here("Outputs", "combined_data", "artifacts_descriptives.rds"))
descriptives_tbl <- descriptives$descriptives_tbl

descriptives_tbl %>%
  as_grouped_data(groups = c("Group")) %>% 
  as_flextable(hide_grouplabel = TRUE) %>% 
  colformat_double(digits = 2, i = 2:10, j = 2:6) %>%
  colformat_double(digits = 2, i = 11:20, j = 2:6) %>%
  colformat_double(digits = , i = 22:26, j = 2:6) %>%
  colformat_double(digits = 2, i = 27:30, j = 2:6) %>%
  width(j = 1, width = 1.5) %>%
  align(align = "center", i = c(1, 11, 21, 24, 27), part = "body") %>%
  autofit(add_w = -0.1)
```


## Methodology (Kea, Duma, Xolani)
The objective of the paper is to evaluate the response by banks to macroprudential reforms and whether the reforms are consistent with policies aimed at enabling competition and inclusion in the banking industry. Therefore, we evaluate specifications relating to macroprudential reforms and specifications relating to competition and inclusion separately,

### Response to Macroprudential reforms (Kea)
Our aim in this section is to evaluate the response of  credit supply to macroprudeetial reforms. Banks might pass the increase in cost of funding, following tighter macroprudential capital requirements, on to their borrowers in the form of higher interest rate on loans or by reducing the quantity of credit they can extend \citep{noss2016estimating}. As such,  we consider both the response of  stock of outstanding loans and the price of the loans (rates). 
 
 Following \cite{aiyar2016does}, \cite{deli2017real}, \cite{fang2022bank} and \cite{mirzaei2022effectiveness}
 the first baseline panel regression model considers the effect of macroprudnetial reforms on the stock of lending as follow: 
\begin{equation}
    \Delta Loan_{b,i,t+r,t-p}=\beta_{0}+ \beta_{1}MacroPru_{t}++\beta_{3}X_{b,t-p}+ \omega_{b}+ \lambda_{t}+\epsilon_{i,t}
\end{equation}

where the dependent variables is loan growth, defined as as the log-difference in the stock of loans of bank $b$, between the end of month $t=r+r$ and and end of month $t-p$, for lending product $i$. The main explanatory variable is the macroprudential reform ($MacroPru$) indicator, such that $MacroPru=1 $ for dates of events containing announcements and communication
of regulation intended to be passed and the drafting of such regulation, $Draft$ and zero otherwise. Similarly, we also estimate equation (1) for $MacroPru=1 $ for dates of events recording the eventual implementation of the regulation, $Implementation$ and zero otherwise.

We decompose the stock of loans to nine categories, that is $i=1...9$, which consist of three totals, defined as total unsecured lending, total mortgage lending, total secured lending. Unsecured lending is defined as loans, overdrafts and credit cards to households and non-financial sector corporates, while secured lending consist of leasing and instalment sales to households and non-financial sector corporates. Total unsecured lending therefore consist of household unsecured lending and non-financial corporate sector lending. Total mortgage lending consist of residential mortgages to households and commercial mortgages to corporates and households. 


We include a set of time-varying bank-specific controls, captured by $X_{b,t-p}$, consisting of banks' return on assets and total capital adequacy ratio. Furthermore, we use bank-fixed effects $\omega_{b}$ to absorb differences in unobserved and time-invariant bank characteristics. Macroeconomic and policy shocks affecting banks equally such as economic growth and monetary policy are absorbed by time fixed effects $\lambda_{t}$.


Similarly, the specification for the price of lending follows:

\begin{equation}
    P_{b,i}= \beta_{0}+\beta_{1}MacroPru +\beta_{3}X_{b,t-p}+ \omega_{b}+ \lambda_{t}+\epsilon_{i,t}
\end{equation}

where the dependent variable is bank $b's$ lending rate for product $i$. The main explanatory variable $MacroPru$, is defined as in equation (1). The controls are also as in equation(1). 


### Response to financial inclusion events (Duma)

The second baseline panel regression considers the response of banks  to events aimed at enabling  financial  inclusion in the banking industry. We firstly consider the effect of the events
on the stock of lending as follow:


\begin{equation}
     \Delta Loan_{b,i,t+r,t-p}= \beta_{0}+\beta_{1}Inclusion+ \beta_{2}D_{t}+\beta_{3}X_{b,t-p}+ \omega_{b}+ \lambda_{t}+\epsilon_{i,t}
\end{equation}


where the dependent variables is loan growth, defined as as the log-difference in the stock of loans of bank $b$, between the end of month $t=r+r$ and and end of month $t-p$, for lending product $i$. We consider only three loan categories: Total unsecured lending, secured lending and total mortgage lending. The definitions are as in the previous section. $Inclusion$ is a dummy variable, such that $Inclusion=1$ for dates of events where measures aimed at enabling financial inclusion are announced, drafted and implemented.


We also include a set of macro controls which include the repo rate, consumer confidence index and SAVIT40 index and bank-specific control, return on assets. These are captured by $X_{b,t-p}$. We also control for the COVID-19 period, captured by the dummy $D_{t}$ such $D_{t}=1$ from the beginning of the lockdown period until the end of the sample and $0$ otherwise. As with macroprudential specifications, we include  bank-fixed effects $\omega_{b}$  time fixed effects $\lambda_{t}$.


We also evaluate the effect of the reforms on lending rates. The specification is as follow:

\begin{equation}
    P_{b,i}= \beta_{0}+\beta_{1}Inclusion+ \\beta_{2}D_{t}+\beta_{3}X_{b,t-p}+ \omega_{b}+ \lambda_{t}+\epsilon_{i,t}
\end{equation}


where the dependent variable is bank $b's$ lending rate for product $i$.  We consider lending rates on total unsecured lending, secured lending and total mortgage lending.  $Inclusion$, $D_{t}$ and $X_{b,t-p}$ are defined as in equation (3). Bank-fixed effects are captured by $\omega_{b}$, while   $\lambda_{t}$ represent time fixed effects.


\textit{Still need to define equation 5 below}


\begin{equation}
    P_{b,i}= \beta_{0}+\beta_{1}MicroReg+ \beta_{2}D_{t}+\beta_{3}X_{b,t-p}+ \omega_{b}+ \lambda_{t}+\epsilon_{i,t}
\end{equation}

# Results
## Response to macroprudential regulation (Kea)

Banks might pass the increase in cost of funding, following tighter macroprudential capital requirements, on to their borrowers in the form of higher interest rate on loans or by reducing the quantity of credit they can extend \citep{noss2016estimating}

Two possibilities for positive coefficients on lending volumes.
One is the the anticipation effects where  banks have information on the proposed regulation and dates which they will be implemented and as such, they can act (expand credit for instance) before implementation date and thereby take advantage of less stringent requirements on credit extension due to regulation before
tighter requirements are introduced. 

\textit{Secondly, and with positive coefficients with implementation is the idea of portfolio rebalancing. The notion is that banks will reduce their relatively riskier loan portfolio (e.g reduction in unsecured lending) and rebalance their portfolios towards more prudent ones (secured loan portfolio) \citep{deli2017real}. This is due to fact that macroprudential reforms enforce banks to attach greater risk weights to certain loan portfolios such as unsecured credit. For instance, banks in Denmark retrenched more on their lending portfolio with higher risk weights, in response to higher capital requirements \citep{imbierowicz2018time}}. 

\textbf{Similarly, \cite{cappelletti2019impact} find that banks classified as Other Systematically-Important (O-SII), who face added capital requirements, reduce their credit supply to households and financial sectors and shifted their lending to less risky counterparts within the non-financial corporations sector. Similarly, the banks in our sample (FNB, Standard Bank, Nedbank and ABSA) are classified as Domestic-Systematically Important Banks (D-SIB) and are charged additional capital requirements}}. 

\bsideways
```{r}
#| label: tbl-macropru_draft_lending
#| tbl-cap: "Macroprudential regulations and lending volumes (3-months) results"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

macropru_results <- read_rds(here("Outputs", "models", "artifacts_macropru_models.rds"))

macropru_three_month_results <- read_rds(here("Outputs", "models", "artifacts_three_month_macropru_models.rds"))

rows <- modelsummary_basic(
    macropru_three_month_results$three_lending_models$three_month_implementation,
    coef_omit = 2:16,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Implementation model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)

predictor_macro <- c("Draft index", "Implementation index")

dependant_lending <- c(
  " ",
  "Unsecured",
  "Secured",
  "Mortgages",
  "Unsecured",
  "Secured",
  "Mortgages",
  "Unsecured",
  "Secured",
  "Mortgages"
)
modelsummary_word(
  macropru_three_month_results$three_lending_models$three_month_draft,
  coef_omit = 2:16,
  gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
  add_rows = rows_tbl
) %>%
  width(j = 1, width = 1.2) %>%
  add_body_row(values =
                 c("Draft model"),
               colwidths = 10) %>%
  merge_at(i = 3, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporates", "Households"),
    colwidths = c(1, 3, 3, 3)) %>% 
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 3) %>%
  hline(i = 4, j = 1:10, part = "body") %>%
  mk_par(
    i = 2,
    part = "header",
    value = as_paragraph(dependant_lending)
  ) %>% 
  mk_par(
    j = 1,
    i = c(2, 4),
    part = "body",
    value = as_paragraph(predictor_macro)
  ) %>% 
  # add_footer_row(
  #   values = as_paragraph(
  #     "Note: *** = p value < 0.01, ** = 0.01 < p value < 0.05, * = 0.05 < p value < 0.1."
  #   ),
  #   colwidths = 10) %>% 
  # hline(i = 1, part = "footer", border = fp_border(color = "white")) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white"))
```
\esideways


\bsideways
```{r}
#| label: tbl-macropru_draft_rates
#| tbl-cap: "Macroprudential regulation and lending rates"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

rows <- modelsummary_basic(
    macropru_results$rates_models$implementation,
    coef_omit = 2:16,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Implementation model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)

dependant_rate <- c(
  " ",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage"
)



modelsummary_word(
    macropru_results$rates_models$draft,
    coef_omit = 2:16,
    gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
    add_rows = rows_tbl
  ) %>% 
  width(j = 1, width = 1.2) %>% 
   add_body_row(values =
                 c("Draft model"),
               colwidths = 10) %>%
  merge_at(i = 3, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporates", "Households"),
    colwidths = c(1, 3, 3, 3)) %>% 
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 3) %>% 
  hline(i = 4, j = 1:10, part = "body") %>% 
   mk_par(
    i = 2,
    part = "header",
    value = as_paragraph(dependant_rate)
  ) %>% 
  mk_par(
    j = 1,
    i = c(2, 4),
    part = "body",
    value = as_paragraph(predictor_macro)
  ) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white")) %>% 
  autofit(add_w = -10)

```
\esideways


\newpage

## Financial regulation and inclusion (Duma)

\bsideways
```{r}
#| label: tbl-finance_lending
#| tbl-cap: "Finance regulation and lending volumes (3-months) results"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

additional_competition_results <- read_rds(here("Outputs", "models", "artifacts_additional_competition_models.rds"))

rows <- modelsummary_basic(
    additional_competition_results$financial_inclusion_lending_models,
    coef_omit = 3:17,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Financial inclusion model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)

dependant_rate <- c(
  " ",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage"
)

predictor_finance <- c("Finance regulation index", "Covid-dummy", "Financial inclusion index", "Covid-dummy")

modelsummary_word(
    additional_competition_results$finance_lending_models,
    coef_omit = 3:17,
    gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
    add_rows = rows_tbl
  ) %>% 
  width(j = 1, width = 1.2) %>% 
   add_body_row(values =
                 c("Finance regulation model"),
               colwidths = 10) %>%
  merge_at(i = 4, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporates", "Households"),
    colwidths = c(1, 3, 3, 3)) %>% 
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 4) %>% 
  hline(i = 6, j = 1:10, part = "body") %>% 
   mk_par(
    i = 2,
    part = "header",
    value = as_paragraph(dependant_rate)
  ) %>% 
  mk_par(
    j = 1,
    i = c(2, 3, 5, 6),
    part = "body",
    value = as_paragraph(predictor_finance)
  ) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white")) %>% 
  autofit(add_w = -10)

```
\esideways


\bsideways
```{r}
#| label: tbl-finance_rates
#| tbl-cap: "Financial regulation and lending rates results"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

rows <- modelsummary_basic(
    additional_competition_results$financial_inclusion_rates_models,
    coef_omit = 3:17,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Financial inclusion model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)

dependant_rate <- c(
  " ",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage"
)

modelsummary_word(
    additional_competition_results$finance_rates_models,
    coef_omit = 3:17,
    gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
    add_rows = rows_tbl
  ) %>% 
  width(j = 1, width = 1.2) %>% 
   add_body_row(values =
                 c("Finance regulation model"),
               colwidths = 10) %>%
  merge_at(i = 4, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporates", "Households"),
    colwidths = c(1, 3, 3, 3)) %>% 
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 4) %>% 
  hline(i = 6, j = 1:10, part = "body") %>% 
   mk_par(
    i = 2,
    part = "header",
    value = as_paragraph(dependant_rate)
  ) %>% 
  mk_par(
    j = 1,
    i = c(2, 3, 5, 6),
    part = "body",
    value = as_paragraph(predictor_finance)
  ) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white")) %>% 
  autofit(add_w = -10)

```
\esideways
 
## Robustness (Kea and Duma)
## Discussion (???)
# Conclusion (Kea and Duma)

\newpage 
# References 
::: {#refs}
:::


\setcounter{section}{0}
\renewcommand{\thesection}{\Alph{section}}

\setcounter{table}{0}
\renewcommand{\thetable}{A\arabic{table}}

\setcounter{figure}{0}
\renewcommand{\thefigure}{A\arabic{figure}}

\newpage



# Appendix

## Data sources

```{r}
#| label: tbl-data
#| tbl-cap: "Data Sources"
#| cache: FALSE
#| include: TRUE
#| ft.arraystrech: 0.5

tibble(
  " " = c(
    "Macroprudential narrative index",
    "Competition narrative index",
    "BA900",
          "BA930",
          "Controls"),
  "Description" = c(
    "Narrative index of macroprudential regulations in South Africa. ",
    "Narrative index of financial regulations in South Africa",
    "Banking sector balance sheet data at a bank level",
    "Banking sector lending rates at a bank level",
    "Banking sector performance data at a bank level and 
    general macroeconomic data."
  ),
  
  "Availability" = c(
    "Public data",
    "Public data",
    "Public data",
    "Aggregated data is public.
Bank specific data is private",
"Aggregated data is public.
Bank specific data is private"
  ),
"Source" = c(
  "Own analysis",
  "Own analysis",
  "South African Reserve Bank",
  "South African Reserve Bank",
  "Prudential Authority, 
  South African Reserve Bank, 
  Statistics South Africa, 
  Johanesburg Stock Exchange"
)
) %>%
  flextable_word() %>%
  flextable::align(align = "left", part = "all") %>% 
  autofit(add_w = -0.2)

```

```{r}
#| label: tbl-data1
#| tbl-cap: "Data Description"
#| cache: FALSE
#| include: FALSE
#| ft.arraystretch: 0.5


model_variables <- c( "L_{b,t}",
                      "r_{b,t}",
                      "C - C_{min}",
                      "r_t",
                      "\\Omega_{b,t}"
  
)

tibble(
  "Variable Description" = c("Loans by lending category and bank",
                 "Lending rate by lending category and bank",
                 "Capital buffer",
                 "Capital requirement",
                 "Repo rate",
                 "GDP",
                 "Bank level perfomance metrics"
                 ),
  "Data Description" = c("BA 900 data on bank level credit at a monthly frequency. 
We have summarised to six lending categories: 
Household secured credit, Household unsecured credit, Household residential mortgages, 
Non financial sector secured credit, Non financial sector unsecured credit, 
and Non financial sector mortgages as explain in Section 8.2.",
"BA 930 data on bank level lending rates at a monthly frequency. 
Lending rates are defined as the weighted average rate 
by lending category. These were also summarised into the 
same six lending categories as shown in Section 8.2.",
"Aggregate amount of qualifying capital and 
reserve funds less minimum required capital and reserve funds.",
"Basel III required level of capital as a percentage of risk-weighted assets",
"South African Reserve Bank policy rate",
"Nominal gross domestic product.",
"The following are bank perfomance metrics are include in the data: 
total assets, gross loan advances, retained earnings,
net interest income (12 months), level one high-quality liquid assets required to be held, 
average daily amount of level one high-quality liquid assets held up to 
fourteenth business day of the month following the month to which this return relates, 
aggregate risk weighted exposure, return on equity, return on assets, 
total capital adequacy ratio, and leverage ratio."
                    
                    ),
  "Measure" = c("Rand","Percent", "Percent", "Percent", "Percent", "Rand", "Rand and percent"),
  "Cross-section" = c("Nedbank, First National Bank, Standard Bank, Absa",
                      "Nedbank, First National Bank, Standard Bank, Absa",
                      "Nedbank, First National Bank, Standard Bank, Absa",
                      "Nedbank, First National Bank, Standard Bank, Absa",
                      "NA",
                      "NA",
                      "Nedbank, First National Bank, Standard Bank, Absa"
                      ),
  "Sample" = c("January 2008 to November 2022", 
               "January 2012 to June 2022",
               "January 2008 to September 2020",
               "January 2008 to September 2020",
               "January 2008 to February 2021",
               "March 2008 to March 2022",
               "January 2008 to September 2022"),
  "Frequency" = c (
  "Monthly",
  "Monthly",
  "Monthly",
   "Monthly",
  "Monthly",
  "Quartely",
  "Monthly"
  ),
  
) %>% 
  flextable_word(
    caption = "Data Description") %>%
  align(j = 1, part = "all", align = "left") %>% 
  fit_to_width(max_width = 10) 

```

\newpage
## Aggregation scheme

```{r}
#| label: tbl-scheme
#| tbl-cap: "Aggregation schema"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: .55

tibble(
  "BA 900 Categories" = 
    c(
      "Installment sales",
      "",
      "",
      "",
      "Leasing transactions",
      "",
      "",
      "",
      "Farm mortgages",
      "",
      "",
      "Residential mortgages",
      "",
      "",
      "Commercial and other mortgages",
      "",
      "",
      "",
      "",
      "",
      "Credit cards",
      "",
      "",
      "",
      "Overdrafts",
      "",
      "",
      "",
      "",
      "",
      "Factoring debtors",
      "Other loans and advances", 
      "",
      "", 
      "",
      "",
      ""
    ),
  "Item Number" = c(
    141,
    142,
    143,
    144,
    146,
    147,
    148,
    149,
    152,
    153,
    154,
    156,
    157,
    158,
    160,
    161,
    162,
    163,
    164,
    165,
    167,
    168,
    169,
    170,
    178,
    181,
    182,
    183,
    184,
    185,
    187,
    189,
    190, 
    191, 
    192,
    193,
    ""
    
  ),
  "Sector" = c(
    "Financial corporate sector",
    "Non financial corporate sector",
    "Household sector",
    "Other",
    "Financial corporate sector",
    "Non financial corporate sector",
    "Household sector",
    "Other",
    "Non financial corporate sector",
    "Household sector",
    "Other",
    "Non financial corporate sector",
    "Household sector",
    "Other",
    "Public financial corporates",
    "Public non-financial corporates",
    "Private financial corporate",
    "Private non-financial corporates",
    "Household sector",
    "Other",
    "Financial corporate sector",
    "Non financial corporate sector",
    "Household sector",
    "Other",
    "Public sector (includes public corporations and local government)",
    "Financial corporate sector",
    "Non financial corporate sector",
    "Unincorporated business enterprises",
    "Other Household sector",
    "Non-profit organisations serving households",
    "",
    "Financial corporate sector",
    "Non financial corporate sector",
    "Unincorporated business enterprises",
    "Other Household sector",
    "Non-profit organisations serving households",
    ""
  ),
  "Aggregation Key" = c(
    "-",
    "g",
    "h",
    "-",
    "-",
    "g",
    "h",
    "-",
    "d",
    "d",
    "-",
    "e",
    "-",
    "-",
    "-",
    "-",
    "d",
    "d",
    "-",
    "-",
    "a",
    "b",
    "-",
    "-",
    "-",
    "-",
    "-",
    "a",
    "-",
    "b",
    "-",
    "-",
    "a",
    "-",
    "b",
    "-",
    ""
  ),
) %>% 
  flextable_word(caption = "Aggregation schema") %>% 
  align(align = "left", part = "all") %>%
  colformat_num(digits = 0, j = 2) %>% 
  autofit(add_w = -0.2)


```


The following aggregation scheme which results in nine categories was followed based on @tbl-scheme:

a.	Non-financial corporate unsecured lending: Items 168 + 183 + 190 
b.	Household unsecured lending: Items 169 + 185 + 192   
c.	Total unsecured lending: Non-financial corporate unsecured lending + Household unsecured lending
d.	Commercial mortgages to corporates and households: Items 152 + 153 + 156 + 163 + 164   
e.  Residential mortgages to household: Item 157
f.	Total mortgage lending: Commercial mortgages to corporates and households + Residential mortgages to household
g.	Leasing and instalments to corporates: Items 142 + 147
h.  Leasing and instalments to households: Items 143 + 148
i.  Total leasing and instalments: Leasing and instalments to corporates + Leasing and instalments to households

\newpage
## Bank lending rates weighting scheme

The loans quantities from the BA900s are then linked to the lending rate data from the BA930s using table to create nine lending rate categories the schema on @tbl-scheme_1. The weights for each category are then calculated by dividing the total value of the loans in each category by the total value of all loans in the BA900s. The weights are then used to calculate the weighted average lending rate for each month. The weighted average lending rate is calculated by multiplying the lending rate for each category by the weight for that category and then summing the results.

```{r}
#| label: tbl-scheme_1
#| tbl-cap: "Weighting schema"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: .55

tibble(
  "Sector" = c(
   "Corporate sector",
   "",
   "",
   "",
   "",
   "",
   "",
   "",
   "",
   "Household sector",
   "",
   "",
   "",
   "",
   "",
   "",
   "",
   ""
  ),
  "BA 930 Categories" = c(
    "Overdraft rate",
    "Instalment sale agreements flexible rate",
    "Instalment sale fixed rate",
    "Leasing transactions flexible rate",
    "Leasing transactions fixed rate",
    "Mortgage advances flexible rate",
    "Mortgage advances fixed rate",
    "Credit card rate",
    "Other",
    "Overdraft rate",
    "Instalment sale agreements flexible rate",
    "Instalment sale fixed rate",
    "Leasing transactions flexible rate",
    "Leasing transactions fixed rate",
    "Mortgage advances flexible rate",
    "Mortgage advances fixed rate",
    "Credit card rate",
    "Other"
  ),
  "Item Number" = c(
    48,
    49,
    50,
    51,
    52,
    53,
    54,
    55,
    56,
    58,
    59,
    60,
    61,
    62,
    63,
    64,
    65,
    66
  ),
  "Weighting Key" = c(
    "a and c",
    "g and i",
    "-",
    "g and i",
    "-",
    "d and f",
    "-",
    "a and c",
    "a and c",
    "b and c",
    "h and i",
    "-",
    "h and i",
    "-",
    "e and f",
    "-",
    "b and c",
    "b and c"
  )
) %>% 
  flextable_word() %>% 
  align(align = "left", part = "all") %>%
  colformat_num(digits = 0, j = 3) %>% 
  autofit(add_w = .35)

```

The nine categories, therefore, are as follows:

a.	Non-financial corporate unsecured lending: Weighted average of items 55 + 48 + 56
b.	Household unsecured lending: Weighted average of items 65 + 58 + 66
c.	Total unsecured lending: Weighted average of items 55 + 48 + 56 + 65 + 58 + 66
d.	Commercial mortgages to corporates and households: Weighted average of items 53
e.  Residential mortgages to household:  Item 63
f.	Total mortgage lending: Weighted average of items 53 + 63
g.	Leasing and instalments to corporates: Weighted average of items 49 + 51
h.  Leasing and instalments to households: Weighted average of items 59 + 61
i.  Total leasing and instalments: Weighted average of items 49 + 51 + 59 + 61




\newpage
## Aggregated bank lending

```{r}
#| label: fig-bank_lending
#| fig-cap: "Total aggregated bank lending"
#| fig-height: 6
#| fig-width: 6
#| cache: TRUE

bank_lending <- read_rds(here("Outputs","BA900","artifacts_BA900.rds"))
bank_lending_gg <- bank_lending$aggregated_graphs$total_aggregation_gg
bank_lending_gg
```


## Weighted lending rates (aggregated)

```{r}
#| label: fig-bank_interest_rates
#| fig-cap: "Weighted lending rates"
#| fig-height: 6
#| fig-width: 6
#| cache: FALSE

bank_interest_rates <- 
  read_rds(here("Outputs","BA930","artifacts_BA930_futher_analysis.rds"))

bank_interest_rates_gg <- bank_interest_rates$gg$aggregated_lending_rates_gg
bank_interest_rates_gg
```


<!-- ## Aggregated bank controls (check) -->

```{r}
#| label: fig-controls
#| fig-cap: "Aggregated bank controls"
#| fig-height: 7.5
#| fig-width: 6
#| cache: FALSE
#| include: FALSE
#| eval: FALSE

controls <- read_rds(here("Outputs","BA920","artifacts_BA920.rds"))
controls_gg <- controls$graphs$Total_banks_gg
controls_gg
```




\newpage
## Description of narrative events

### Macroprudential Indicators

This section provides a detailed account of the narrative macroprudential indicators.
  
2008/01/01:  \textcolor{ForestGreen}{Implementation}
\begin{quote}
            BASEL II is  Implemented until Dec 2011

\end{quote}

2009/02/04: \textcolor{blue}{Announcement, draft and passing of regulation}

\begin{quote}
SARB issues  \textbf{directive 1/2009 (1 of 2009)} announcing the approach banks should follow in the application of capital floors. "Modelled capital should not be below 80\% of the capital requirements under Basel I to ensure capital levels do not fall below prudent level". Following Basel II, banks are allowed to use internal models to determine risk weights and in turn, determine capital levels. However, capital floors ensure capital requirements did not fall below a certain percentage of banks’ capital requirements under the previous Basel I framework\citep{basel06}. This in essence, imply greater risk weight arched to riskier credit products. For instance,  \cite{imbierowicz2018time} show that Danish banks reducing their lending on loans with higher risk weights, in response to higher capital requirements, including approaches to capital floors.
\end{quote}

2009/07/31*: \textcolor{blue}{Announcement, draft and passing of regulation}

\begin{quote}BCBS announces "measures to strengthen the 1996 rules governing trading book capital and to enhance the three pillars of the Basel II framework (Basel 2.5)". This in essence, aims  to introduce higher capital requirements to capture the credit risk of complex trading activities, promote the build-up of capital buffers that can be drawn down in periods of stress and strengthen the quality of bank capital\citep{basel09}
\end{quote}
 

2010/10/08*: \textcolor{blue}{Announcement, draft and passing of regulation}
\begin{quote}SARB issues \textbf{circular 3/2010} endorsing and giving notices to banks to prepare for the implementation of Basel 2.5, following the communication by the BCBS on July 31, 2009
\end{quote}

 2011/06/30*:   \textcolor{blue}{Announcement, draft and passing of regulation}

\begin{quote}BCBS issues and publishes Basel III: A Global Regulatory Framework for More Resilient Banks and Banking Systems. ???
\end{quote}


2011/07/31: \textcolor{blue}{Announcement, draft and passing of regulation}
\begin{quote} 
Cabinet adopts proposal to shift to Twin Peaks Model of Financial Regulation in South Africa, following he GFC, with the aim of improving  institutional structure to support financial regulation. Stricter oversight on finacial system, implications for financial inculsion??
\end{quote}

2011/10/31: \textcolor{blue}{Announcement, draft and passing of regulation}

\begin{quote}
Basel 2.5 is transposed into domestic law (next step is implementation)
\end{quote}

2012/01/01: \textcolor{ForestGreen}{Implementation}

\begin{quote}
    Basel 2.5 takes effect: SARB minimum capital requirements
    \begin{itemize}
        \item Total CET1, 5.25\%, Total Tier1, 7\%, Minimum regulatory capital, 8\%, Total regulatory capital for D-SIB, 9.5\%
    \end{itemize}
\end{quote}



2012/02/16*:  \textcolor{blue}{Announcement, draft and passing of regulation}

\begin{quote}
SARB issues \textbf{guidance note 2/2012} announcing on new definition of total regulatory capital for Basel III such as:
\begin{itemize}
    \item Phasing out arrangements for non-common equity Tier 1 capital instruments that no longer qualify as regulatory capital under Basel III
 \item Transitional arrangements for Basel III implementation
\item Treatment of disclosed reserves undrer Basel III
\end{itemize}
\end{quote}



2012/05/31*: \textcolor{blue}{Announcement, draft and passing of regulation}

\begin{quote}
SARB issues \textbf{guidance Note G5/2012} announcing that it will provide  liquidity facility to assist banks in meeting the liquidity Coverage Ratio (LCR) and cash reserves can be included as banks' high quality liquid assets for calculating LCR. This follows results from the QIS exercises by banks,  which revealed some banks would have shortfalls of around R140 billion in meeting the 100\ LCR  by 1 Jan 2019 due do to reliance eon short-term funding limited availability of HQLA

\begin{itemize}
    \item LCR requirements will be introduced on \textbf{1 Jan 2015} at 60\%, increasing by 10\% to reach 100\% on 1 Jan 2019
\item Level 1 assets (stocks, funds or bonds) shall comprise 60\% of total HQLA  while level 2 assets (less liquid) shall constitute no more than the remaining 40\%
\item SARB proposes that Leverage ratio be set at 4\% (LR of 4\% implies that banks' leverage does not exceed its capital by 40\%)
\end{itemize}
\end{quote}

2012/08/15*: \textcolor{blue}{Announcement, draft and passing of regulation}
\begin{quote}
SARB transposes Basel III into law and publishes Counter-cyclical Capital Buffer (CCyB) rules, set to be implemented on 1 January 2016
\end{quote}

2013/01/31/*: \textcolor{ForestGreen}{Implementation}
\begin{quote}
    Basel III takes effect
\end{quote}

2013/08/20: \textcolor{blue}{Announcement, draft and passing of regulation}
\begin{quote}
 SARB issues \textbf{Guidance Note 6/2013} announcing that banks' cash reserves may be included as part of their level 1 HQLA. Only equities listed on JSE's main exchange and included on Top 40 Index shall be considered as level2 HQLA (\textit{Potentially limit banks' ability to raise capital}).
\end{quote}


2014/01/31: \textcolor{ForestGreen}{Implementation}
\begin{quote}
SARB mimimum Capital Requirements increase to:\\
Total CET1, 5,5\%, Total Tier1, 7\%, Total regulatory capital, 8\%, Total regulatory capital for D-SIB, 10\%
\end{quote}

2014/12/31: \textcolor{blue}{Announcement, draft and passing of regulation}
\begin{quote}
SARB issues \textbf{guidance note 8/2014} announcing  the provision of a committed liquidity facility  (CLF). This is to assist banks to meet the LCR.
Banks, however need to have collateral to access the CLF, consisting of:
\begin{itemize}
    \item  High-quality residential mortgage loans
\item Other loans and advances such as VAF, excluding unsecured loans
\item Domestically listed securities
\end{itemize}
\textit{Banks with less diversified asset portfolio, i.e small banks will probably not qualify? Further restrictions/ stricter measures to loan extension?}
\end{quote}

2015/01/31*: \textcolor{ForestGreen}{Implementation}
\begin{quote}
LCR ratio is introduced/impelemnted at 60\% compliance
\end{quote}

2015/12/31*: \textcolor{blue}{Announcement, draft and passing of regulation}
\begin{quote}

SARB issues \textbf{circular 8/2015} announcing timelines and targets in respect of  the implementation of the countercyclical capital buffer (CCyB). SARB requirements shall apply to bank-wide total RWA:
\begin{itemize}
    \item 0.625\% on 1 Jan 2016
\item 1.25\% 1 Jan 2017
\item 1.875\% on 1 Jan 2018
\item 2.5\% on 1 Jan 2019
\end{itemize}
\end{quote}


2016/01/31*: \textcolor{ForestGreen}{Implementation}
\begin{quote}
LCR ratio is introduced/implemented at 60\% compliance. CCyB also implemented at 0.625\% 
\end{quote}

2016/04/13*: \textcolor{blue}{Announcement, draft and passing of regulation}
\begin{quote}
SARB issues \textbf{directive 1/2016} to inform all banks of matters related to the exposure limits imposed in the classification of deposits and credit exposures to small and medium enterprises  (SMEs), to be implemented on 1 July 2016. For instance, total exposure of a bank to an SME borrower, which shall be determined or calculated on a consolidated basis, at no time exceeds R12,5 million (\textit{Greater limits on value of a loan that can be extended to an SME and in turn, financial exclusion?})
\end{quote}

2016/07/01*: \textcolor{ForestGreen}{Implementation}
\begin{quote}
Exposure limits imposed in the classification of deposits and credit exposures to small and medium enterprises  (SMEs), announced on 2016/04/13, implemented
\end{quote}


2017/01/31*: \textcolor{ForestGreen}{Implementation}
\begin{quote}
LCR ratio is introduced/implemented at 80\% compliance, while CCyB increases to 1.25\%
\end{quote}


2017/12/13*: \textcolor{blue}{Announcement, draft and passing of regulation}

\begin{quote}
SARB issues \textbf{directive 8/2017} informing banks to comply with NSFR framework and on matters retaled to calibration of NSFR, including  template to monitor NSFR compliance. Agrees to start implementation on 1 January 2018. Objective is to reduce funding risk over a longer time horizon by requiring banks to fund their activities with sufficiently stable sources of funding in order to mitigate the risk of future funding stress. \textit{anks will be required to match their funding with their outflows, which may lead to a greater demand for longer term funding. Longer term funding will result in an increased cost of funding for banks (possibly passed on to borrowers and lower profitability and returns for banks}
\end{quote}

2018/01/31*: \textcolor{ForestGreen}{Implementation}
\begin{quote}
NSFR Implemented following  Directive 8/2017, CCyB increases to 1,875\% and LCR is implemented at 90\% compliance.
\end{quote}

2019/01/31*: \textcolor{ForestGreen}{Implementation}
\begin{quote}
CCyB increases to 2,5\% (maximum) and LCR is implemented at 100\% compliance.
\end{quote}

## Macroprudential narrative indexes

```{r}
#| label: fig-macro_narrative_indexes_one_month
#| fig-cap: "One month lending growth and macroprudential narrative index comparison. Note: The black line represents the Draft index, and the red line represents the Implementation index."
#| fig-height: 8
#| fig-width: 8
#| cache: FALSE

narratives <- read_rds(here("Outputs","combined_data", "artifacts_visual_lag_test.rds"))
macropru_narratives_one_month_gg <- narratives$macropru$one_month_test_macropru_gg
macropru_narratives_one_month_gg

```

\newpage

```{r}
#| label: fig-macro_narrative_indexes_three_month
#| fig-cap: "Three month lending growth and macroprudential narrative indexes comparison. Note: The black line represents the Draft index, and the red line represents the Implementation index."
#| fig-height: 9
#| fig-width: 8
#| cache: FALSE

macropru_narratives_one_month_gg <- narratives$macropru$three_month_test_macropru_gg
macropru_narratives_one_month_gg

```


\newpage

## Financial regulation narrative indexes

```{r}
#| label: fig-comp_narrative_indexes_one_month
#| fig-cap: "One month lending growth and financial narrative index comparison. Note: The black line represents the Financial regulation index, and the red line represents the Financial inclusion index."
#| fig-height: 8
#| fig-width: 8
#| cache: FALSE

finance_narratives_one_month_gg <- narratives$finance$one_month_test_finance_gg
finance_narratives_one_month_gg
```

\newpage

```{r}
#| label: fig-comp_narrative_indexes_three_month
#| fig-cap: "Three month lending growth and financial narrative indexes comparison. Note: The black line represents the Financial regulation index, and the red line represents the Financial inclusion index."
#| fig-height: 8
#| fig-width: 8
#| cache: FALSE

finance_narratives_three_months_gg <- narratives$finance$three_month_test_finance_gg
finance_narratives_three_months_gg
```

\newpage


## Results with controls

\bsideways
```{r}
#| label: tbl-macropru_draft_lending_control
#| tbl-cap: "Macroprudential regulations and lending volumes (3-months) with controls results"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

macropru_control_results <- read_rds(here("Outputs", "models", "artifacts_macropru_controls_models.rds"))

rows <- modelsummary_basic(
    macropru_control_results$lending_models$implementation,
    coef_omit = 4:18,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Implementation model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)

predictor_control <-
  c(
    "Draft index",
    "Return on assets",
    "Total capital adequacy ratio",
    "Implementation index",
    "Return on assets",
    "Total capital adequacy ratio"
  )

predictor_control <- c(
  "Draft index",
  "Return on assets",
  "Total capital adequacy ratio",
  "Implementation index",
  "Return on assets",
  "Total capital adequacy ratio"
)

modelsummary_word(
  macropru_control_results$lending_models$draft,
  coef_omit = 4:18,
  gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
  add_rows = rows_tbl
) %>%
  width(j = 1, width = 1.4) %>%
  add_body_row(values =
                 c("Draft model"),
               colwidths = 10) %>%
  merge_at(i = 5, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporates", "Households"),
    colwidths = c(1, 3, 3, 3)) %>%
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 5) %>%
  hline(i = 8, j = 1:10, part = "body") %>%
  mk_par(i = 2,
         part = "header",
         value = as_paragraph(dependant_lending)) %>%
  mk_par(
    j = 1,
    i = c(2, 3, 4, 6, 7, 8),
    part = "body",
    value = as_paragraph(predictor_control)
  ) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white")) 
```
\esideways


\bsideways
```{r}
#| label: tbl-macropru_draft_rates_control
#| tbl-cap: "Macroprudential regulation and lending rates with controls results"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

rows <- modelsummary_basic(
    macropru_control_results$rates_models$implementation,
    coef_omit = 4:18,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Implementation model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)


modelsummary_word(
    macropru_control_results$rates_models$draft,
    coef_omit = 4:18,
    gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
    add_rows = rows_tbl
  ) %>% 
  width(j = 1, width = 1.4) %>% 
   add_body_row(values =
                 c("Draft model"),
               colwidths = 10) %>%
  merge_at(i = 5, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporations", "Households"),
    colwidths = c(1, 3, 3, 3)) %>%
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 5) %>%
  hline(i = 8, j = 1:10, part = "body") %>%
  mk_par(i = 2,
         part = "header",
         value = as_paragraph(dependant_rate)) %>%
  mk_par(
    j = 1,
    i = c(2, 3, 4, 6, 7, 8),
    part = "body",
    value = as_paragraph(predictor_control)
  ) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white"))

```
\esideways


\bsideways
```{r}
#| label: tbl-finance_control_lending
#| tbl-cap: "Finance regulation and lending volumes (3-months) with controls results"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

additional_competition_controls_results <- read_rds(here("Outputs", "models", "artifacts_additional_competition_control_models.rds"))

rows <- modelsummary_basic(
    additional_competition_controls_results$financial_inclusion_lending_models,
    coef_omit = 5:19,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Financial inclusion model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)

dependant_rate <- c(
  " ",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage"
)

predictor_finance_controls <-
  c("Finance regulation index",
    "Covid-dummy",
    "Repo rate",
    "Consumer confidence",
    "Return on assets",
    "SAVIT40 index",
    "Financial inclusion index",
    "Covid-dummy",
    "Repo rate",
    "Consumer confidence",
    "Return on assets",
    "SAVIT40 index")


modelsummary_word(
    additional_competition_controls_results$finance_lending_models,
    coef_omit = 5:19,
    gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
    add_rows = rows_tbl
  ) %>% 
  width(j = 1, width = 1.2) %>% 
   add_body_row(values =
                 c("Finance regulation model"),
               colwidths = 10) %>%
  merge_at(i = 8, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporates", "Households"),
    colwidths = c(1, 3, 3, 3)) %>% 
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 8) %>% 
  hline(i = 14, j = 1:10, part = "body") %>% 
   mk_par(
    i = 2,
    part = "header",
    value = as_paragraph(dependant_rate)
  ) %>% 
  mk_par(
    j = 1,
    i = c(2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14),
    part = "body",
    value = as_paragraph(predictor_finance_controls)
  ) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white")) %>% 
  autofit(add_w = -10)

```
\esideways


\bsideways
```{r}
#| label: tbl-finance_control_rates
#| tbl-cap: "Finance regulation and lending rates with controls results"
#| cache: FALSE
#| include: TRUE
#| ft.arraystretch: 1

rows <- modelsummary_basic(
    additional_competition_controls_results$financial_inclusion_rates_models,
    coef_omit = 5:19,
    gof_omit = "AIC|BIC|Std|Log",
    output = "dataframe"
  ) [, c(2, 4:12)] %>% 
  add_row(
   term = "Bank Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) %>% 
  add_row(
   term = "Monthly Fixed Effects",  
  `(1)` = "Yes", 
  `(2)` = "Yes", 
  `(3)` = "Yes", 
  `(4)` = "Yes", 
  `(5)` = "Yes", 
  `(6)` = "Yes", 
  `(7)` = "Yes", 
  `(8)` = "Yes", 
  `(9)` = "Yes"
  ) 
  
rows_tbl <-  tibble(
  "term" = "Financial inclusion model",  
  "(1)" = " ", 
  "(2)" = " ", 
  "(3)" = " ", 
  "(4)" = " ", 
  "(5)" = " ", 
  "(6)" = " ", 
  "(7)" = " ", 
  "(8)" = " ", 
  "(9)" = " ") %>% 
  add_row(rows)

dependant_rate <- c(
  " ",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage",
  "Unsecured",
  "Secured",
  "Mortgage"
)

modelsummary_word(
    additional_competition_controls_results$finance_rates_models,
    coef_omit = 5:19,
    gof_omit = "AIC|BIC|Std|Log|Num.Obs.",
    add_rows = rows_tbl
  ) %>% 
  width(j = 1, width = 1.2) %>% 
   add_body_row(values =
                 c("Finance regulation model"),
               colwidths = 10) %>%
  merge_at(i = 8, j = 1:10) %>%
  add_header_row(
    values = c("", "Total", "Corporates", "Households"),
    colwidths = c(1, 3, 3, 3)) %>% 
  align(align = "center", part = "header", i = 1) %>%
  align(align = "center", part = "body", i = 1) %>%
  align(align = "center", part = "body", i = 8) %>% 
  hline(i = 14, j = 1:10, part = "body") %>% 
   mk_par(
    i = 2,
    part = "header",
    value = as_paragraph(dependant_rate)
  ) %>% 
  mk_par(
    j = 1,
    i = c(2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14),
    part = "body",
    value = as_paragraph(predictor_finance_controls)
  ) %>% 
  hline(i = 1, j = 1:1, part = "header", border = fp_border(color = "white")) %>% 
  autofit(add_w = -10)

```
\esideways

